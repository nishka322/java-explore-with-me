{
	"info": {
		"_postman_id": "c84db4af-4311-4343-adfc-340634d8d3f1",
		"name": "Stats Service API Tests",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "48499688",
		"_collection_link": "https://nishka322-7372231.postman.co/workspace/Maks's-Workspace~5fc7089c-6817-428d-83ca-360726ec6d48/collection/48499688-c84db4af-4311-4343-adfc-340634d8d3f1?action=share&source=collection_link&creator=48499688"
	},
	"item": [
		{
			"name": "01. Health Check",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Server is running', function() {",
							"    pm.response.to.have.status(200);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "http://localhost:9090/actuator/health",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "9090",
					"path": [
						"actuator",
						"health"
					]
				}
			},
			"response": []
		},
		{
			"name": "02. POST /hit - Create endpoint hit",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Response should be JSON with id', function() {",
							"    pm.response.to.be.json;",
							"    pm.response.to.have.status(201);",
							"    const json = pm.response.json();",
							"    pm.expect(json.id).to.be.a('number');",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"app\": \"ewm-main-service\",\n  \"uri\": \"/events/1\",\n  \"ip\": \"192.163.0.1\",\n  \"timestamp\": \"2024-01-31 14:20:00\"\n}"
				},
				"url": {
					"raw": "http://localhost:9090/hit",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "9090",
					"path": [
						"hit"
					]
				}
			},
			"response": []
		},
		{
			"name": "03. POST /hit - Another hit with same URI",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Status should be 201 Created', function() {",
							"    pm.response.to.have.status(201);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"app\": \"ewm-main-service\",\n  \"uri\": \"/events/1\",\n  \"ip\": \"192.163.0.2\",\n  \"timestamp\": \"2024-01-31 15:20:00\"\n}"
				},
				"url": {
					"raw": "http://localhost:9090/hit",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "9090",
					"path": [
						"hit"
					]
				}
			},
			"response": []
		},
		{
			"name": "04. POST /hit - Hit with different URI",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Status should be 201 Created', function() {",
							"    pm.response.to.have.status(201);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"app\": \"ewm-main-service\",\n  \"uri\": \"/events/2\",\n  \"ip\": \"192.163.0.1\",\n  \"timestamp\": \"2024-01-31 16:20:00\"\n}"
				},
				"url": {
					"raw": "http://localhost:9090/hit",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "9090",
					"path": [
						"hit"
					]
				}
			},
			"response": []
		},
		{
			"name": "05. GET /stats - Basic (all URIs, unique=false)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Status should be 200 OK', function() {",
							"    pm.response.to.have.status(200);",
							"});",
							"pm.test('Response should be JSON array', function() {",
							"    const json = pm.response.json();",
							"    pm.expect(json).to.be.an('array');",
							"});",
							"pm.test('Should have correct structure', function() {",
							"    const json = pm.response.json();",
							"    json.forEach(item => {",
							"        pm.expect(item).to.have.keys('app', 'uri', 'hits');",
							"        pm.expect(item.app).to.be.a('string');",
							"        pm.expect(item.uri).to.be.a('string');",
							"        pm.expect(item.hits).to.be.a('number');",
							"    });",
							"});",
							"pm.test('Should have both URIs', function() {",
							"    const json = pm.response.json();",
							"    const uris = json.map(item => item.uri);",
							"    pm.expect(uris).to.include('/events/1');",
							"    pm.expect(uris).to.include('/events/2');",
							"});",
							"pm.test('Should have correct hit counts', function() {",
							"    const json = pm.response.json();",
							"    const event1 = json.find(item => item.uri === '/events/1');",
							"    const event2 = json.find(item => item.uri === '/events/2');",
							"    if (event1) pm.expect(event1.hits).to.equal(2);",
							"    if (event2) pm.expect(event2.hits).to.equal(1);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "http://localhost:9090/stats?start=2024-01-01 00:00:00&end=2024-12-31 23:59:59&unique=false",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "9090",
					"path": [
						"stats"
					],
					"query": [
						{
							"key": "start",
							"value": "2024-01-01 00:00:00"
						},
						{
							"key": "end",
							"value": "2024-12-31 23:59:59"
						},
						{
							"key": "unique",
							"value": "false"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "06. GET /stats - Filter by URI (/events/1)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Status should be 200 OK', function() {",
							"    pm.response.to.have.status(200);",
							"});",
							"pm.test('Should return only /events/1', function() {",
							"    const json = pm.response.json();",
							"    json.forEach(item => {",
							"        pm.expect(item.uri).to.equal('/events/1');",
							"    });",
							"    if (json.length > 0) {",
							"        pm.expect(json[0].hits).to.equal(2);",
							"    }",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "http://localhost:9090/stats?start=2024-01-01 00:00:00&end=2024-12-31 23:59:59&uris=/events/1&unique=false",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "9090",
					"path": [
						"stats"
					],
					"query": [
						{
							"key": "start",
							"value": "2024-01-01 00:00:00"
						},
						{
							"key": "end",
							"value": "2024-12-31 23:59:59"
						},
						{
							"key": "uris",
							"value": "/events/1"
						},
						{
							"key": "unique",
							"value": "false"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "07. GET /stats - Unique IP only (unique=true)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Status should be 200 OK', function() {",
							"    pm.response.to.have.status(200);",
							"});",
							"pm.test('Unique hits should be 2 (different IPs)', function() {",
							"    const json = pm.response.json();",
							"    if (json.length > 0) {",
							"        pm.expect(json[0].hits).to.equal(2);",
							"    }",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "http://localhost:9090/stats?start=2024-01-01 00:00:00&end=2024-12-31 23:59:59&uris=/events/1&unique=true",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "9090",
					"path": [
						"stats"
					],
					"query": [
						{
							"key": "start",
							"value": "2024-01-01 00:00:00"
						},
						{
							"key": "end",
							"value": "2024-12-31 23:59:59"
						},
						{
							"key": "uris",
							"value": "/events/1"
						},
						{
							"key": "unique",
							"value": "true"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "08. GET /stats - Multiple URIs filter",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Status should be 200 OK', function() {",
							"    pm.response.to.have.status(200);",
							"});",
							"pm.test('Should return both URIs', function() {",
							"    const json = pm.response.json();",
							"    const uris = json.map(item => item.uri);",
							"    pm.expect(uris).to.include('/events/1');",
							"    pm.expect(uris).to.include('/events/2');",
							"    pm.expect(uris.length).to.equal(2);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "http://localhost:9090/stats?start=2024-01-01 00:00:00&end=2024-12-31 23:59:59&uris=/events/1&uris=/events/2&unique=false",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "9090",
					"path": [
						"stats"
					],
					"query": [
						{
							"key": "start",
							"value": "2024-01-01 00:00:00"
						},
						{
							"key": "end",
							"value": "2024-12-31 23:59:59"
						},
						{
							"key": "uris",
							"value": "/events/1"
						},
						{
							"key": "uris",
							"value": "/events/2"
						},
						{
							"key": "unique",
							"value": "false"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "09. GET /stats - Error: missing start parameter",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Missing start should return 400', function() {",
							"    pm.expect(pm.response.code).to.be.oneOf([400, 422]);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "http://localhost:9090/stats?end=2024-12-31 23:59:59",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "9090",
					"path": [
						"stats"
					],
					"query": [
						{
							"key": "end",
							"value": "2024-12-31 23:59:59"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "10. GET /stats - Error: missing end parameter",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Missing end should return 400', function() {",
							"    pm.expect(pm.response.code).to.be.oneOf([400, 422]);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "http://localhost:9090/stats?start=2024-01-01 00:00:00",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "9090",
					"path": [
						"stats"
					],
					"query": [
						{
							"key": "start",
							"value": "2024-01-01 00:00:00"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "11. POST /hit - Error: invalid data",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Invalid data should return 400', function() {",
							"    pm.expect(pm.response.code).to.be.oneOf([400, 422]);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"app\": \"\",\n  \"uri\": \"\",\n  \"ip\": \"not-an-ip\",\n  \"timestamp\": \"invalid-date\"\n}"
				},
				"url": {
					"raw": "http://localhost:9090/hit",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "9090",
					"path": [
						"hit"
					]
				}
			},
			"response": []
		},
		{
			"name": "12. GET /stats - Encoded spaces test",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Encoded spaces should work', function() {",
							"    pm.response.to.have.status(200);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "http://localhost:9090/stats?start=2024-01-01+00:00:00&end=2024-12-31+23:59:59",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "9090",
					"path": [
						"stats"
					],
					"query": [
						{
							"key": "start",
							"value": "2024-01-01+00:00:00"
						},
						{
							"key": "end",
							"value": "2024-12-31+23:59:59"
						}
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"exec": [
					"console.log('Starting Stats Service API Tests');"
				],
				"type": "text/javascript"
			}
		},
		{
			"listen": "test",
			"script": {
				"exec": [
					"console.log('Test completed: ' + pm.info.requestName);"
				],
				"type": "text/javascript"
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:9090"
		}
	]
}